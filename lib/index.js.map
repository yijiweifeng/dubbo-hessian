{"version":3,"sources":["../src/index.js"],"names":["require","default","str","vider","readDir","P","readdir","parser2","name","zk","connectTimeout","retries","dubbo_version","service_version","service_group","strictString","ip","username","password","client","createClient","connect","init","readFile","self","domains","services","forEach","ele","index","keys","clzName","fns","methods","method","regs","exec","type","ret","fn","value","undefined","stringSafeChange","firstLowCase","substr","lastIndexOf","args","el","push","type_","isArray","indexOf","match","i","length","dataCheck","check","error","message","state","invoke","file_finished","finish_call","readNode","host","children","getChildren","node","consumer","query","interface","service","ser_param","parse","ser_host","hostname","revision","version","timestamp","Date","getTime","addNode","encodeURIComponent","format","info","node_finished","called","emit","once","protocol","slashes","application","category","dubbo","side","exists","watch","stat","create","random","arr","Math","floor","methodName","resolve","reject","domain_","on","err","code","toString","run","proxy","reply","fault","status","data","hasOwnProperty","EventEmitter"],"mappings":"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","file":"index.js","sourcesContent":["/**\r\n * Created by cc on 16/8/11.\r\n */\r\n'use strict';\r\nimport url from 'url';\r\nimport events from 'events';\r\nimport fs from 'fs';\r\nimport domain from 'domain';\r\nimport querystring from 'querystring';\r\n\r\n\r\nimport zookeeper from 'node-zookeeper-client';\r\nimport parser from 'java-class-parser-generics';\r\nimport Proxy from 'hessian-proxy-cn';\r\n\r\nimport tool from './toolkit.js';\r\n\r\nrequire('babel-runtime/core-js/promise').default = require('bluebird');\r\n\r\nlet str = '', vider = 'providers';\r\nlet readDir = tool.P(fs.readdir);\r\nlet parser2 = tool.P(parser);\r\n\r\nexport default class extends events.EventEmitter {\r\n    /**\r\n     * @param json对象，key的含义如下:\r\n     *  name（app标识）,\r\n     *  zk(注册中心地址 ip:port\r\n     *  dubbo_version(展示到注册中心的消费者dubbo版本,默认2.8.4),\r\n     *  service_version(服务版本,默认为任意版本,不为空时在ZK中心只获取指定版本的服务),\r\n     *  service_group = 'dubbo'(服务分组,默认dubbo,这也是dubbo服务端在不指定分组时的默认分组)\r\n     *  strictString = true(是否过滤所有提交字符串中的script/frame等)\r\n     *  host(固定调用的服务器地址ip,不传表示调用任意地址,例如 10.0.0.1表示只调用10.0.0.1上的服务)\r\n     *  username zk用户名\r\n     *  password zk密码\r\n     */\r\n    constructor({name = 'node-client', zk, connectTimeout = 1000, retries = 3, dubbo_version = '2.8.4', service_version = false, service_group = 'dubbo', strictString = true, ip = false, username = '', password = ''} = {}) {\r\n        super();\r\n        this.client = zookeeper.createClient(zk, {\r\n            connectTimeout: connectTimeout,\r\n            retries: retries\r\n        });\r\n        this.client.connect();\r\n        this.name = name;\r\n        this.dubbo_version = dubbo_version;\r\n        this.service_version = service_version;\r\n        this.service_group = service_group;\r\n        this.strictString = strictString;\r\n        this.ip = ip;\r\n        this.username = username;\r\n        this.password = password;\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * 读取class\r\n     */\r\n    async readFile() {\r\n        let self = this;\r\n        let domains = await readDir('./interface/domain');\r\n        this.domains = {};\r\n        this.services = {};\r\n        domains.forEach((ele, index) => {\r\n            domains[index] = `./interface/domain/${ele}`;\r\n        });\r\n        domains = await parser2(domains);\r\n        domains.keys.forEach((clzName) => {\r\n            let fns = {};\r\n            domains[clzName].methods.forEach((method) => {\r\n                var regs = /^get(\\w*)/.exec(method.name);\r\n                if (regs !== null) {\r\n                    var type = method.ret, fn;\r\n                    switch (type) {\r\n                        case 'java.lang.String' :\r\n                            fn = (value) => {\r\n                                if (value === null || value === undefined || value === 'null') {\r\n                                    return null;\r\n                                }\r\n                                return tool.stringSafeChange(this.strictString, value + str);\r\n                            };\r\n                            break;\r\n                        case 'int' :\r\n                        case 'float' :\r\n                        case 'double' :\r\n                        case 'long' :\r\n                            fn = (value) => {\r\n                                if (value === '' || value === undefined || value === null) {\r\n                                    return 0;\r\n                                }\r\n                                return +value;\r\n                            };\r\n                            break;\r\n                        case 'java.lang.Integer' :\r\n                        case 'java.lang.Double' :\r\n                        case 'java.lang.Float' :\r\n                        case 'java.lang.Long' :\r\n                        case 'java.lang.Number' :\r\n                            fn = (value) => {\r\n                                if (value === '' || value === undefined || value === null) {\r\n                                    return null;\r\n                                }\r\n                                return +value;\r\n                            };\r\n                            break;\r\n                        case 'java.math.BigDecimal' :\r\n                            fn = (value) => {\r\n                                if (value === '' || value === undefined || value === null) {\r\n                                    return null;\r\n                                } else if (typeof value === 'object') {\r\n                                    if (value.value === '' || value.value === undefined || value.value === null) return null;\r\n                                    else return {value: +value.value}\r\n                                } else {\r\n                                    return {value: +value}\r\n                                }\r\n                            };\r\n                            break;\r\n                        case 'boolean' :\r\n                            fn = (value) => {\r\n                                if (value === '' || value === undefined || value === null) {\r\n                                    return false;\r\n                                } else if (typeof value === 'string') {\r\n                                    return value === 'true';\r\n                                } else {\r\n                                    return value\r\n                                }\r\n                            };\r\n                            break;\r\n                        case 'java.lang.Boolean' :\r\n                            fn = (value) => {\r\n                                if (value === '' || value === undefined) {\r\n                                    return null;\r\n                                } else if (typeof value === 'string') {\r\n                                    return value === 'true';\r\n                                } else {\r\n                                    return value\r\n                                }\r\n                            };\r\n                            break;\r\n                        default :\r\n                            fn = (value) => {\r\n                                return value;\r\n                            };\r\n                            break;\r\n                    }\r\n                    fns[tool.firstLowCase(regs[1])] = fn;\r\n                }\r\n            });\r\n            this.domains[clzName] = fns;\r\n        });\r\n        domains = await readDir('./interface/service');\r\n        domains.forEach((ele, index) => {\r\n            domains[index] = `./interface/service/${ele}`;\r\n        });\r\n        domains = await parser2(domains);\r\n        domains.keys.forEach((clzName) => {\r\n            domains[clzName].methods.forEach((method) => {\r\n                let name = clzName.substr(clzName.lastIndexOf('.') + 1), fns = [];\r\n                method.args.forEach((el) => {\r\n                    switch (el) {\r\n                        case 'java.lang.String' :\r\n                            fns.push((value) => {\r\n                                if (value === null || value === undefined || value === 'null') {\r\n                                    return null;\r\n                                }\r\n                                return tool.stringSafeChange(value + str);\r\n                            });\r\n                            break;\r\n                        case 'int' :\r\n                        case 'float' :\r\n                        case 'double' :\r\n                        case 'long' :\r\n                            fns.push((value) => {\r\n                                return +value;\r\n                            });\r\n                            break;\r\n                        case 'java.lang.Integer' :\r\n                        case 'java.lang.Double' :\r\n                        case 'java.lang.Float' :\r\n                        case 'java.lang.Long' :\r\n                        case 'java.lang.Number' :\r\n                            fns.push((value) => {\r\n                                if (value !== null && value !== undefined && value !== '') {\r\n                                    return +value;\r\n                                }\r\n                                return null;\r\n                            });\r\n                            break;\r\n                        case 'java.math.BigDecimal' :\r\n                            fns.push((value) => {\r\n                                if (value === '' || value === undefined || value === null) {\r\n                                    return null;\r\n                                } else if (typeof value === 'object') {\r\n                                    if (value.value === '' || value.value === undefined || value.value === null) return null;\r\n                                    else return {value: +value.value}\r\n                                } else {\r\n                                    return {value: +value}\r\n                                }\r\n                            });\r\n                            break;\r\n                        case 'java.lang.Boolean' :\r\n                            fns.push((value) => {\r\n                                if (value === '' || value === undefined) {\r\n                                    return null;\r\n                                } else if (typeof value === 'string') {\r\n                                    return value === 'true';\r\n                                } else {\r\n                                    return value\r\n                                }\r\n                            });\r\n                            break;\r\n                        default :\r\n                            var type_, isArray = false;\r\n                            if (el.indexOf('java.util.List') === -1) {\r\n                                type_ = el;\r\n                            } else {\r\n                                type_ = el.match(/<(.*)>/);\r\n                                isArray = true;\r\n                                type_ !== null && (type_ = type_[1]);\r\n                            }\r\n                            if (domains.indexOf(type_) > -1) {\r\n                                if (isArray === true) {\r\n                                    fns.push((value) => {\r\n                                        if (value !== null && value !== undefined) {\r\n                                            for (var i = 0; i < value.length; i++) {\r\n                                                if (value[i] !== null && value[i] !== undefined) {\r\n                                                    value[i] = tool.dataCheck(value[i], type_);\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                        return value;\r\n                                    });\r\n                                } else {\r\n                                    fns.push((value) => {\r\n                                        if (value !== null && value !== undefined) {\r\n                                            value = tool.dataCheck(value, type_);\r\n                                        }\r\n                                        return value;\r\n                                    });\r\n                                }\r\n                            } else {\r\n                                fns.push((value) => {\r\n                                    return value;\r\n                                });\r\n                            }\r\n                            break;\r\n                    }\r\n                });\r\n                this.services[name][method.name] = async function () {\r\n                    var args = Array.from(arguments);\r\n                    if (args.length !== self.services[name][method.name].check.length) {\r\n                        throw {\r\n                            error: `请求${clzName}.${method.name}时参数不符,class定义了${self.services[name][method.name].check.length}个,传了${args.length}个!`,\r\n                            message: `请求${clzName}.${method.name}时参数不符,class定义了${self.services[name][method.name].check.length}个,传了${args.length}个!`,\r\n                            state: 101005\r\n                        };\r\n                    }\r\n                    args.forEach((value, index) => {\r\n                        args[index] = self.services[name][method.name].check[index](value);\r\n                    });\r\n                    return await self.invoke(clzName, method.name, args);\r\n                };\r\n                this.services[name][method.name].check = fns;\r\n            });\r\n        });\r\n        this.file_finished = true;\r\n        this.finish_call();\r\n    }\r\n\r\n    /**\r\n     * 读取节点\r\n     */\r\n    async readNode() {\r\n        this.host = {};\r\n        let children = this.getChildren(`/${this.service_group}`, () => {\r\n            this.readNode();\r\n        });\r\n        children.forEach((node) => {\r\n            this.host[node] = [];\r\n            let services = this.getChildren(`/${this.service_group}/${node}/${vider}`);\r\n            this.consumer.query.interface = node;\r\n            services.forEach((service) => {\r\n                let ser_param = querystring.parse(service);\r\n                if (this.service_version !== false && (ser_param['default.version'] || ser_param['version']) !== this.service_version) return;\r\n                let ser_host = url.parse(service);\r\n                if (this.ip !== false && ser_host.hostname !== this.ip) return;\r\n                this.consumer.host = `${host}/${node}`;\r\n                this.consumer.query.revision = this.consumer.query.version = ser_param['default.version'] || ser_param['version'];\r\n                this.consumer.query.timestamp = (new Date()).getTime();\r\n                this.host[node].push(ser_host.host);\r\n                this.addNode(`/${this.service_group}/${node}/consumers/${encodeURIComponent(url.format(info))}`);\r\n            });\r\n        });\r\n        this.node_finished = true;\r\n        this.finish_call();\r\n    }\r\n\r\n    /**\r\n     * 成功回调\r\n     */\r\n    finish_call() {\r\n        if (this.file_finished === true && this.node_finished === true && this.called === false) {\r\n            this.called = true;\r\n            this.emit(\"success\");\r\n        }\r\n    }\r\n\r\n    init() {\r\n        this.host = {};\r\n        this.client.once('connected', () => {\r\n            this.consumer = {\r\n                protocol: 'consumer',\r\n                slashes: 'true',\r\n                host: str,\r\n                query: {\r\n                    application: this.name,\r\n                    category: 'consumers',\r\n                    check: 'false',\r\n                    dubbo: this.dubbo_version,\r\n                    interface: str,\r\n                    revision: str,\r\n                    version: str,\r\n                    side: 'consumer',\r\n                    timestamp: str\r\n                }\r\n            };\r\n            this.getChildren = tool.P(this.client.getChildren);\r\n            this.exists = tool.P(this.client.exists);\r\n            this.readNode();\r\n        }).once('disconnected', () => {\r\n            this.host = {};\r\n        });\r\n        fs.watch('./interface', this.readFile);\r\n        this.readFile();\r\n        this.client.connect();\r\n    }\r\n\r\n    /**\r\n     * 添加节点\r\n     * @param node\r\n     */\r\n    async addNode(node) {\r\n        let stat = await this.exists(node);\r\n        if (stat) return;\r\n        self.client.create(node, 1);\r\n    }\r\n\r\n    /**\r\n     * 随机算法\r\n     * @param length\r\n     * @returns {number}\r\n     */\r\n    random(arr) {\r\n        return arr[Math.floor(Math.random() * (length))];\r\n    }\r\n\r\n    /**\r\n     * 执行方法\r\n     * @param clzName\r\n     * @param methodName\r\n     * @param args\r\n     * @returns {Promise}\r\n     */\r\n    invoke(clzName, methodName, args) {\r\n        return new Promise((resolve, reject) => {\r\n            if (this.host[clzName] === undefined || this.host[clzName].length === 0) {\r\n                throw {\r\n                    error: `zk中找不到${clzName}对应的服务节点`,\r\n                    message: `zk中找不到${clzName}对应的服务节点`,\r\n                    state: 101003\r\n                };\r\n            }\r\n            let host = this.random(this.host[clzName]);\r\n            let domain_ = domain.create();\r\n            domain_.on('error', (err) => {\r\n                throw {\r\n                    error: err,\r\n                    message: err,\r\n                    state: 101003\r\n                };\r\n                if (err.code && err.code.toString() === 'ECONNREFUSED') {\r\n                    throw {\r\n                        error: `连接${host}/${clzName}失败!`,\r\n                        message: `连接${host}/${clzName}失败!`,\r\n                        state: 101002\r\n                    };\r\n                } else {\r\n                    throw {\r\n                        error: `${clzName}发生错误 ${err.code}`,\r\n                        message: `${clzName}发生错误 ${err.code}`,\r\n                        state: 101005\r\n                    };\r\n                }\r\n            });\r\n            domain_.run(() => {\r\n                var proxy = new Proxy(`http://${host}/${clzName}`, this.username, this.password, proxy);\r\n                proxy.invoke(methodName, args, (err, reply) => {\r\n                    if (reply && reply.fault === true) {\r\n                        reject({\r\n                            message: `${clzName}/${methodName}发生异常!`,\r\n                            error: `${clzName}/${methodName}发生异常!`,\r\n                            state: 101004\r\n                        });\r\n                    } else if (err) {\r\n                        reject({\r\n                            message: `${clzName}/${methodName}发生异常：${JSON.stringify(err)}`,\r\n                            error: `${clzName}/${methodName}发生异常：${JSON.stringify(err)}`,\r\n                            state: 101004\r\n                        });\r\n                    } else if (reply.status > 0) {\r\n                        reject({\r\n                            message: reply.data,\r\n                            error: reply.data,\r\n                            state: reply.status\r\n                        });\r\n                    } else {\r\n                        resolve(reply.hasOwnProperty(\"data\") ? reply.data : reply);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n}"]}